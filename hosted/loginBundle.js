(()=>{var e={35:e=>{const{Component:t}=React;e.exports=class extends t{constructor(e){super(e),this.state={color:"danger",message:"",linkText:"",linkHref:"#"},this.clearMessage=()=>{this.setState({color:"danger",message:"",linkText:"",linkHref:"#"})},this.showSpinner=()=>{this.setState({color:"white",message:React.createElement("span",{className:"spinner-border",role:"status","aria-hidden":"true"}),linkText:"",linkHref:"#"})},this.showError=(e,t,a)=>{this.setState({color:"danger",message:e,linkText:t,linkHref:a||"#"})},this.showSuccess=(e,t,a)=>{this.setState({color:"success",message:e,linkText:t,linkHref:a||"#"})}}render(){return React.createElement("div",{className:"errorMessageContainer"},React.createElement("h3",{className:`text-${this.state.color}`},this.state.message),React.createElement("a",{href:this.state.linkHref},this.state.linkText))}}},489:(e,t,a)=>{const{Component:r,createRef:n}=React,{distanceNoSqrt:o,loadImage:s}=a(144),l=a(520),{emptyBoard:i,width:c,height:m,defaultCodeBase:u,validateMoveStruct:d}=a(245);e.exports=class extends r{constructor(e){super(e),this.state={disabled:!1,holdingBall:!1},this.canvasRef=n(),this.canvasOuterRef=n(),this.game=new l(e.basis),this.code=(e=u)=>this.game.code(e),this.history=()=>this.game.moveHistory,this.editMode=e.editMode,this.onMove=e.onMove||(()=>{}),this.onSolve=e.onSolve||(()=>{}),this.undo=()=>{this.game.undo(this.editMode),this.hintOnDisplay=null,this.onMove()},this.hintOnDisplay=null,this.displayHint=e=>{d(e)&&(this.hintOnDisplay=e)}}static getDerivedStateFromProps(e,t){return e.disabled!==t.disabled?{disabled:e.disabled,holdingBall:!e.disabled&&t.holdingBall}:null}componentDidMount(){const e=this.canvasRef.current,t=e.width,a=e.height,r=this.canvasOuterRef.current,n=e.getContext("2d"),l=i(),u=382/c,d=382/m,h=[];for(let e=0;e<m;e++){const t=[],a=d*(e+.5)+109,r=d*e+109;for(let n=0;n<c;n++)2!==l[e][n]&&(t[n]={x:u*(n+.5)+109,y:a,left:u*n+109,top:r});h[e]=t}const p=Object.entries({board:"board.png",ball:"ball.png",ballShadow:"ball-shadow.png"}),g=p.length,f={};let y=t/2,v=a/2;const x=t=>{if(!t)return;let a,n;const o=t.type.slice(0,5);"touch"===o?(a=t.touches[0].pageX,n=t.touches[0].pageY):"mouse"===o&&(a=t.pageX,n=t.pageY),y=(a-r.offsetLeft)*(e.width/r.offsetWidth),v=(n-r.offsetTop)*(e.height/r.offsetHeight)};let R=Math.floor(c/2),S=Math.floor(m/2);const w=e=>{x(e),R=Math.floor((y-109)/u),S=Math.floor((v-109)/d)};let E=0,z=0;const b=()=>{this.hintOnDisplay=null,this.onMove(),1===this.game.countBalls()&&this.onSolve()},M=e=>{if(this.state.disabled)return;w(e);const t=this.game.puzzle[S];if(t){const e=t[R];if(void 0!==e){const t=h[S][R];o(y,v,t.x,t.y)<400&&("toggleBalls"===this.editMode?this.game.toggleBall(R,S)&&b():1===e&&(this.setState({holdingBall:!0}),E=R,z=S))}}},N=e=>{if(this.state.disabled||!this.state.holdingBall||"toggleBalls"===this.editMode)return;this.setState({holdingBall:!1}),w(e);const t={from:{x:E,y:z},to:{x:R,y:S}};let a;a="solveReverse"===this.editMode?this.game.makeMove({from:t.to,to:t.from},!0):this.game.makeMove(t),a&&b()};r.onmousedown=M,r.onmousemove=x,r.onmouseup=N,r.onmouseout=N,r.ontouchstart=M,r.ontouchmove=x,r.ontouchend=N,r.ontouchcancel=N;const B=()=>{requestAnimationFrame(B),n.clearRect(0,0,t,a),n.drawImage(f.board,0,0,t,a),n.lineWidth=3,n.lineJoin="miter",n.strokeStyle="black",n.fillStyle="black";for(let e=0;e<m;e++)for(let t=0;t<c;t++){const a=h[e][t];a&&(1!==this.game.puzzle[e][t]||this.state.holdingBall&&t===E&&e===z||n.drawImage(f.ballShadow,a.x-26,a.y-26,52,52))}if(this.hintOnDisplay){n.lineWidth=6,n.lineJoin="round",n.strokeStyle="red",n.fillStyle="red";const e=this.hintOnDisplay.from,t=h[e.y][e.x],a=t.x,r=t.y,o=this.hintOnDisplay.to,s=h[o.y][o.x],l=s.x-a,i=s.y-r,c=a+.75*l,m=r+.75*i,u=.05*i,d=.05*l;n.beginPath(),n.moveTo(a+.25*l,r+.25*i),n.lineTo(c,m),n.lineTo(c+u,m+d),n.lineTo(a+.85*l,r+.85*i),n.lineTo(c-u,m-d),n.lineTo(c,m),n.closePath(),n.stroke(),n.fill()}this.state.holdingBall&&n.drawImage(f.ball,y-26,v-26,52,52)},T=[];for(let e=0;e<g;e++)T[e]=s(`assets/img/${p[e][1]}`);Promise.all(T).then((e=>{for(let t=0;t<g;t++)f[p[t][0]]=e[t];B()}))}render(){return React.createElement("div",{ref:this.canvasOuterRef,className:"gameBoardCanvasOuter"},React.createElement("div",{className:"ratio1x1"},React.createElement("div",{className:"ratioContainer"},React.createElement("canvas",{ref:this.canvasRef,className:"gameBoardCanvas",width:"600",height:"600"}))))}}},279:e=>{e.exports=e=>{const{username:t,dontShowLogin:a,dontShowTitle:r}=e;return React.createElement("nav",{className:"navFlex"},React.createElement("div",null,r?null:React.createElement("a",{href:"/",className:"logo logoLink"},React.createElement("span",{className:"logoPegSoli"},"Peg Soli"),React.createElement("span",{className:"logoShare"},"Share"))),React.createElement("div",null,a?null:t?React.createElement(React.Fragment,null,"Welcome, ",React.createElement("span",{className:"welcomeUsername"},t)," | ",React.createElement("a",{href:"/account"},"Settings")," | ",React.createElement("a",{href:"/logout"},"Log out")):React.createElement(React.Fragment,null,React.createElement("a",{className:"btn btn-primary",href:"/login?signup"},"Sign up")," or ",React.createElement("a",{href:"/login"},"log in"))))}},995:(e,t,a)=>{e.exports.ErrorMessage=a(35),e.exports.GameBoardUI=a(489),e.exports.Nav=a(279)},242:(e,t,a)=>{const{Nav:r}=a(995);e.exports={renderNav:(e,t)=>{const a=document.getElementById("navRoot");ReactDOM.createRoot(a).render(React.createElement(r,{username:a.dataset.username,dontShowTitle:e,dontShowLogin:t}))}}},520:(e,t,a)=>{const{emptyBoard:r,width:n,height:o,validMoveDeltas:s,validMoveDeltaCount:l,isCode:i,isPuzzle:c,codeToPuzzle:m,puzzleToCode:u,defaultCodeBase:d,countBalls:h,validateMoveStruct:p,findMoveDelta:g}=a(245);e.exports=class{constructor(e){e?c(e)?this.puzzle=e:i(e)?this.puzzle=m(e):i(e,2)?this.puzzle=m(e,2):this.puzzle=r():this.puzzle=r(),this.moveHistory=[]}validateMove(e,t){if(!p(e))return null;const a=e.from.x,r=e.from.y,s=e.to.x,l=e.to.y,i=g(a,r,s,l);if(!i)return null;const c=i.middle,m=a+c.x,u=r+c.y;if(a<0||a>=n)return null;if(r<0||r>=o)return null;if(s<0||s>=n)return null;if(l<0||l>=o)return null;const d=t?0:1,h=t?0:1,f=t?1:0;return this.puzzle[r][a]!==d||this.puzzle[u][m]!==h||this.puzzle[l][s]!==f?null:{matchingDelta:i,moveMid:{x:m,y:u}}}allValidMoves(e){const t=[];for(let a=0;a<o;a++)for(let r=0;r<n;r++)if(1===this.puzzle[a][r])for(let n=0;n<l;n++){const o=s[n],l=e?{from:{x:r-o.x,y:a-o.y},to:{x:r,y:a}}:{from:{x:r,y:a},to:{x:r+o.x,y:a+o.y}};this.validateMove(l,e)&&t.push(l)}return t}makeMove(e,t,a){const r=this.validateMove(e,t);if(!r)return!1;const{moveMid:n}=r,o=e.from,s=e.to,l=t?1:0,i=t?1:0,c=t?0:1;return this.puzzle[o.y][o.x]=l,this.puzzle[n.y][n.x]=i,this.puzzle[s.y][s.x]=c,a||this.moveHistory.push(e),!0}toggleBall(e,t,a){const r=this.puzzle[t][e];return 2!==r&&(this.puzzle[t][e]=0===r?1:0,a||this.moveHistory.push({toggle:{x:e,y:t}}),!0)}undo(e){const t=this.moveHistory.pop();if(!t)return;const{toggle:a}=t;a?this.toggleBall(a.x,a.y,!0):this.makeMove(t,!e,!0)}countBalls(){return h(this.puzzle)}puzzleToString(){return this.puzzle.map((e=>Array.from(e).map((e=>[".","O"," "][e])).join(" "))).join("\n")}code(e=d){return u(this.puzzle,e)}}},144:e=>{const t=e=>{const t=Math.floor(e/36e5),a=Math.floor(e/6e4)%60,r=Math.floor(e/1e3)%60,n=e%1e3;return`${t.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}.${n.toString().padStart(3,"0")}`};e.exports={distanceNoSqrt:(e,t,a,r)=>{const n=a-e,o=r-t;return n*n+o*o},byteToBits:e=>e.toString(2).padStart(8,"0"),byteFromBitRemainder:e=>parseInt(e.padEnd(8,"0"),2),formatTime:t,progressPercent:(e,t)=>{const a=e.toString().padStart(2,"0").padStart(4," "),r=` [32m${a.slice(0,-1)}.${a.slice(-1)}%[39m`;process.stdout.cursorTo(t),process.stdout.write(r)},doneHavingStartedAt:e=>{const a=Date.now()-e;process.stdout.write(`\nDone after ${t(a)}\n`)},loadImage:e=>new Promise(((t,a)=>{const r=new Image;r.crossOrigin="Anonymous",r.src=e,r.onload=()=>{t(r)},r.onerror=e=>{a(e)}})),sendPost:async(e,t)=>{const a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();return r.redirect&&(window.location=r.redirect),r}}},245:e=>{const t=()=>{const e=[new Uint8Array([2,2,0,0,0,2,2]),new Uint8Array([2,2,0,0,0,2,2]),new Uint8Array([0,0,0,0,0,0,0]),new Uint8Array([0,0,0,0,0,0,0]),new Uint8Array([0,0,0,0,0,0,0]),new Uint8Array([2,2,0,0,0,2,2]),new Uint8Array([2,2,0,0,0,2,2])];return Object.seal(e),e},a=[{name:"right",x:2,y:0,middle:{x:1,y:0}},{name:"up",x:0,y:-2,middle:{x:0,y:-1}},{name:"left",x:-2,y:0,middle:{x:-1,y:0}},{name:"down",x:0,y:2,middle:{x:0,y:1}}],r=[[2,1,0,5,4,3,12,11,10,9,8,7,6,19,18,17,16,15,14,13,26,25,24,23,22,21,20,29,28,27,32,31,30],[30,31,32,27,28,29,20,21,22,23,24,25,26,13,14,15,16,17,18,19,6,7,8,9,10,11,12,3,4,5,0,1,2],[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0],[6,13,20,7,14,21,0,3,8,15,22,27,30,1,4,9,16,23,28,31,2,5,10,17,24,29,32,11,18,25,12,19,26],[26,19,12,25,18,11,32,29,24,17,10,5,2,31,28,23,16,9,4,1,30,27,22,15,8,3,0,21,14,7,20,13,6],[12,19,26,11,18,25,2,5,10,17,24,29,32,1,4,9,16,23,28,31,0,3,8,15,22,27,30,7,14,21,6,13,20],[20,13,6,21,14,7,30,27,22,15,8,3,0,31,28,23,16,9,4,1,32,29,24,17,10,5,2,25,18,11,26,19,12]],n=r.length,o=(e,t)=>{const a=r[t];let n="";for(let t=0;t<33;t++)n+=e.charAt(a[t]);return n},s=parseInt("1".repeat(33),2),l=[];for(let e=2;e<=36;e++)l[e]=(i=e,s.toString(i).length);var i;const c=(e,t,a)=>parseInt(e,t).toString(a).padStart(l[a],"0"),m=[];for(let e=2;e<=36;e++)m[e]=new RegExp(`^[${"0123456789abcdefghijklmnopqrstuvwxyz".slice(0,e)}]{${l[e]}}$`);const u=[4,8,10,14,18,22,24,28],d=u.length,h=2**d;e.exports={emptyBoard:t,width:7,height:7,slotCount:33,validMoveDeltas:a,validMoveDeltaCount:4,findMoveDelta:(e,t,r,n)=>{const o=r-e,s=n-t;let l=null;for(let e=0;e<4;e++){const t=a[e];t.x===o&&t.y===s&&(l=t)}return l},codeRegExps:m,isCode:(e,t=36)=>m[t].test(e),isPuzzle:e=>{if(!e)return!1;const a=t();if(!Array.isArray(e))return!1;const r=e.length;if(7!==r)return!1;for(let t=0;t<r;t++){const r=e[t];if(!(r instanceof Uint8Array))return!1;const n=r.length;if(7!==n)return!1;for(let e=0;e<n;e++){const n=r[e];if(0!==n&&1!==n&&2!==n)return!1;if(2===a[t][e]!=(2===n))return!1}}return!0},copyPuzzle:e=>{const t=[];for(let a=0;a<7;a++)t[a]=new Uint8Array(e[a]);return Object.seal(t),t},codeToPuzzle:(e,a=36)=>{const r=2===a?e:c(e,a,2),n=t();let o=0;for(let e=0;e<7;e++){const t=n[e];for(let e=0;e<7;e++)2!==t[e]&&(t[e]=r[o],o++)}return n},puzzleToCode:(e,t=36)=>{let a="";for(let t=0;t<7;t++){const r=e[t];for(let e=0;e<7;e++){const t=r[e];2!==t&&(a+=t)}}return 2===t?a:c(a,2,t)},convertCodeBase:c,defaultCodeBase:36,transform:o,isometryCount:n,codeImages:e=>{const t=new Set;t.add(e);for(let a=0;a<n;a++)t.add(o(e,a));return Array.from(t)},countBalls:e=>{let t=0;for(let a=0;a<7;a++)for(let r=0;r<7;r++)1===e[a][r]&&t++;return t},codeSampleRange:h,sampleCode:e=>{let t="";for(let a=0;a<d;a++)t+=e.charAt(u[a]);return parseInt(t,2)},validateMoveStruct:e=>e&&e.from&&"number"==typeof e.from.x&&"number"==typeof e.from.y&&e.to&&"number"==typeof e.to.x&&"number"==typeof e.from.y}}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,a),o.exports}(()=>{const{sendPost:e}=a(144),{renderNav:t}=a(242),{createRef:r}=React,{ErrorMessage:n}=a(995),o=t=>{const a=r();return React.createElement(React.Fragment,null,React.createElement("h1",{className:"spacedHeader"},"Log in"),React.createElement("form",{id:"loginForm",name:"loginForm",onSubmit:t=>(async(t,a)=>{t.preventDefault(),a.clearMessage();const r=t.target.querySelector("#user").value,n=t.target.querySelector("#pass").value,o=t.target.querySelector("#next").value,s=t.target.querySelector("#_csrf").value;if(!r||!n)return a.showError("Username or password is empty!"),!1;const{error:l}=await e(t.target.action,{username:r,pass:n,next:o,_csrf:s});return l&&a.showError(l),!1})(t,a.current),action:"/login",method:"POST",className:"mainForm"},React.createElement("div",{className:"formTextboxes"},React.createElement("label",{htmlFor:"username"},"Username: "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"}),React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:t.csrf}),React.createElement("input",{id:"next",type:"hidden",name:"next",value:t.next}),React.createElement("div",{className:"buttonContainerFlex"},React.createElement("input",{className:"btn btn-primary btn-lg",type:"submit",value:"Log in"})),React.createElement("div",{className:"loginSignupSwitch"},"Don't have an account? ",React.createElement("a",{href:"#",onClick:t.onSwitch},"Sign up"))),React.createElement(n,{ref:a}))},s=t=>{const a=r();return React.createElement(React.Fragment,null,React.createElement("h1",{className:"spacedHeader"},"Sign up"),React.createElement("form",{id:"signupForm",name:"signupForm",onSubmit:t=>(async(t,a)=>{t.preventDefault(),a.clearMessage();const r=t.target.querySelector("#user").value,n=t.target.querySelector("#pass").value,o=t.target.querySelector("#pass2").value,s=t.target.querySelector("#next").value,l=t.target.querySelector("#_csrf").value;if(!r||!n||!o)return a.showError("All fields are required!"),!1;if(n!==o)return a.showError("Passwords do not match!"),!1;const{error:i}=await e(t.target.action,{username:r,pass:n,pass2:o,next:s,_csrf:l});return i&&a.showError(i),!1})(t,a.current),action:"/signup",method:"POST",className:"mainForm"},React.createElement("div",{className:"formTextboxes"},React.createElement("label",{htmlFor:"username"},"Username: "),React.createElement("input",{id:"user",type:"text",name:"username",placeholder:"username"}),React.createElement("label",{htmlFor:"pass"},"Password: "),React.createElement("input",{id:"pass",type:"password",name:"pass",placeholder:"password"}),React.createElement("label",{htmlFor:"pass2"},"Retype password: "),React.createElement("input",{id:"pass2",type:"password",name:"pass2",placeholder:"retype password"})),React.createElement("input",{id:"_csrf",type:"hidden",name:"_csrf",value:t.csrf}),React.createElement("input",{id:"next",type:"hidden",name:"next",value:t.next}),React.createElement("div",{className:"buttonContainerFlex"},React.createElement("input",{className:"btn btn-primary btn-lg",type:"submit",value:"Sign up"})),React.createElement("div",{className:"loginSignupSwitch"},"Already have an account? ",React.createElement("a",{href:"#",onClick:t.onSwitch},"Log in"))),React.createElement(n,{ref:a}))};window.onload=async()=>{const e=await fetch("/token"),a=await e.json();t(!1,!0);const r=document.getElementById("loginContentRoot"),{next:n,initial:l}=r.dataset,i=ReactDOM.createRoot(r),c=e=>{e?(document.title="Sign up - Peg SoliShare",i.render(React.createElement(s,{csrf:a.csrfToken,onSwitch:()=>c(!1),next:n}))):(document.title="Login - Peg SoliShare",i.render(React.createElement(o,{csrf:a.csrfToken,onSwitch:()=>c(!0),next:n})))};c("signup"===l)}})()})();